# ì˜ì¡´ì„±

_2024.03.17_

#### 1. ì˜ì¡´ì„± ì£¼ì…

`ì˜ì¡´ì„± ì£¼ì…`ì€ ê³µìš©ëœ ë¡œì§ì„ ê°€ì¡Œì„ ê²½ìš°, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ ê³µìœ í•˜ëŠ” ê²½ìš°, ë³´ì•ˆ ë° ì¸ì¦, ì—­í•  ìš”êµ¬ ì‚¬í•­ ë“±ì„ ê°•ì œí•˜ëŠ” ê²½ìš° ë“±ì— ì½”ë“œ ë°˜ë³µì„ ìµœì†Œí™”í•œë‹¤.

```py
from typing import Annotated

from fastapi import Depends, FastAPI

app = FastAPI()


# ê³µí†µ íŒŒë¼ë¯¸í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜
async def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100):
    return {"q": q, "skip": skip, "limit": limit}


# Depends í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ common_parameters í•¨ìˆ˜ë¥¼ ì˜ì¡´ì„±ìœ¼ë¡œ ì§€ì •
@app.get("/items/")
async def read_items(commons: Annotated[dict, Depends(common_parameters)]):
    return commons


# Depends í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ common_parameters í•¨ìˆ˜ë¥¼ ì˜ì¡´ì„±ìœ¼ë¡œ ì§€ì •
@app.get("/users/")
async def read_users(commons: Annotated[dict, Depends(common_parameters)]):
    return commons


## Annotatedì¸ ì˜ì¡´ì„± ê³µìœ í•˜ê¸°
# ì½”ë“œ ì¤‘ë³µì„ ì¤„ì´ê¸° ìœ„í•´ Annotated ê°’ì„ ë³€ìˆ˜ì— ì €ì¥í•˜ê³  ì—¬ëŸ¬ ì¥ì†Œì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

# Annotatedë¥¼ ì‚¬ìš©í•˜ì—¬ CommonsDep ì •ì˜
CommonsDep = Annotated[dict, Depends(common_parameters)]


# common_parameters í•¨ìˆ˜ì˜ ë°˜í™˜ê°’ì„ ì‚¬ìš©í•˜ëŠ” ì˜ì¡´ì„±
@app.get("/items/")
async def read_items(commons: CommonsDep):
    return commons


# common_parameters í•¨ìˆ˜ì˜ ë°˜í™˜ê°’ì„ ì‚¬ìš©í•˜ëŠ” ì˜ì¡´ì„±
@app.get("/users/")
async def read_users(commons: CommonsDep):
    return commons
```

#### 2. ì˜ì¡´ì„±ìœ¼ë¡œì„œì˜ í´ë˜ìŠ¤

`Python` í´ë˜ìŠ¤ëŠ” í˜¸ì¶œ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— `FastAPI`ì—ì„œ íŒŒì´ì¬ í´ë˜ìŠ¤ë¥¼ ì˜ì¡´ì„±ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```py
from fastapi import Depends, FastAPI

app = FastAPI()


fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]


# ê³µí†µ ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜ë¥¼ ì²˜ë¦¬í•˜ëŠ” í´ë˜ìŠ¤ ì •ì˜
class CommonQueryParams:
    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):
        self.q = q
        self.skip = skip
        self.limit = limit


# CommonQueryParams í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œì„œ,ê³µí†µ ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ì¡´ì„±
@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)): 
    """
    Parameters:
        commons (CommonQueryParams): CommonQueryParams í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œì„œ,
        ê³µí†µ ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ì¡´ì„±
    """
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response

# commons: CommonQueryParams = Depends(CommonQueryParams)ë¥¼
# commons = Depends(CommonQueryParams)ë¡œ ì‘ì„±í•´ë„ ëœë‹¤.


## ì½”ë“œ ë‹¨ì¶•
# CommonQueryParamsë¥¼ ë‘ ë²ˆì´ë‚˜ ì‘ì„±í•˜ëŠ” ì½”ë“œ ë°˜ë³µì„ ì¤„ì¸ë‹¤.
@app.get("/items/")
async def read_items(commons: CommonQueryParams = Depends()):
    response = {}
    if commons.q:
        response.update({"q": commons.q})
    items = fake_items_db[commons.skip : commons.skip + commons.limit]
    response.update({"items": items})
    return response
```

#### 3. í•˜ìœ„ ì¢…ì†ì„±

í•˜ìœ„ ì¢…ì†ì„±ì„ ê°–ëŠ” ì¢…ì†ì„±ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

```py
from typing import Annotated

from fastapi import Cookie, Depends, FastAPI

app = FastAPI()

# ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜ë¥¼ ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜
def query_extractor(q: str | None = None):
    return q

# ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜ ë˜ëŠ” ì¿ í‚¤ì—ì„œ ê°’ì„ ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜
def query_or_cookie_extractor(
    q: Annotated[str, Depends(query_extractor)], # query_extractor í•¨ìˆ˜ë¥¼ ì˜ì¡´ì„±ìœ¼ë¡œ ì§€ì •
    last_query: Annotated[str | None, Cookie()] = None, # Cookie ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ì˜ì¡´ì„±ì„ ì§€ì •
):
    if not q:
        return last_query
    return q


@app.get("/items/")
async def read_query(
    query_or_default: Annotated[str, Depends(query_or_cookie_extractor)]
):
    """
    Parameters:
        query_or_default (Annotated[str, Depends(query_or_cookie_extractor)]):
            query_or_cookie_extractor í•¨ìˆ˜ì˜ ë°˜í™˜ ê°’ì„ ì‚¬ìš©í•˜ëŠ” ì˜ì¡´ì„±.
            ì´ë¥¼ í†µí•´ ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜(q) ë˜ëŠ” ì¿ í‚¤ ê°’(last_query)ì„ ì¶”ì¶œí•œë‹¤.
    """
    return {"q_or_cookie": query_or_default}
```

1. ë™ì¼í•œ ì¢…ì†ì„±ì„ ì—¬ëŸ¬ ë²ˆ ì‚¬ìš©

- ì¢…ì†ì„± ì¤‘ í•˜ë‚˜ê°€ ë™ì¼í•œ ê²½ë¡œ ì‘ì—…ì— ëŒ€í•´ ì—¬ëŸ¬ ë²ˆ ì„ ì–¸ëœ ê²½ìš° (ex: ì—¬ëŸ¬ ì¢…ì†ì„±ì´ ê³µí†µ í•˜ìœ„ ì¢…ì†ì„±ì„ ê°–ëŠ” ê²½ìš°)ì—ëŠ” ìš”ì²­ë‹¹ í•œ ë²ˆë§Œ í•´ë‹¹ í•˜ìœ„ ì¢…ì†ì„±ì„ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ ì¸ì‹í•œë‹¤.
- ë™ì¼í•œ ìš”ì²­ì— ëŒ€í•´ ì¢…ì†ì„±ì„ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•˜ëŠ” ëŒ€ì‹  ë°˜í™˜ëœ ê°’ì„ `"ìºì‹œ"` ì— ì €ì¥í•˜ê³  í•´ë‹¹ íŠ¹ì • ìš”ì²­ì— í•„ìš”í•œ ëª¨ë“  `"ì¢…ì†ì"`ì—ê²Œ ì „ë‹¬í•œë‹¤.

```py
# Dependsë¥¼ ì‚¬ìš©í•  ë•Œ use_cache=false ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
async def needy_dependency(fresh_value: Annotated[str, Depends(get_value, use_cache=False)]):
    return {"fresh_value": fresh_value}
```

#### 4. ê²½ë¡œ ì‘ë™ ë°ì½”ë ˆì´í„°ì—ì„œì˜ ì˜ì¡´ì„±

ëª‡ëª‡ ê²½ìš°ì—ëŠ”, ê²½ë¡œ ì‘ë™ í•¨ìˆ˜ ì•ˆì—ì„œ ì˜ì¡´ì„±ì˜ ë°˜í™˜ ê°’ì´ í•„ìš”í•˜ì§€ ì•Šê±°ë‚˜ ì˜ì¡´ì„±ì´ ê°’ì„ ë°˜í™˜í•˜ì§€ ì•ŠëŠ”ë‹¤.
> ê·¸ëŸ° ê²½ìš°ì—, `Depends`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²½ë¡œ ì‘ë™ í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ì„ ì–¸í•˜ëŠ” ê²ƒë³´ë‹¤ ê²½ë¡œ ì‘ë™ ë°ì½”ë ˆì´í„°ì— `dependencies`ì˜ `list`ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```py
from fastapi import Depends, FastAPI, Header, HTTPException
from typing_extensions import Annotated

app = FastAPI()

# í† í°ì„ í™•ì¸í•˜ëŠ” ì˜ì¡´ì„± í•¨ìˆ˜
async def verify_token(x_token: Annotated[str, Header()]):
    """
    Parameters:
        x_token (Annotated[str, Header()]): X-Token í—¤ë”ì˜ ê°’ì„ ë°›ëŠ”ë‹¤.
    
    Raises:
        HTTPException: í† í°ì´ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° 400 ìƒíƒœ ì½”ë“œì™€ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•œë‹¤.
    """
    if x_token != "fake-super-secret-token":
        raise HTTPException(status_code=400, detail="X-Token header invalid")

# í‚¤ë¥¼ í™•ì¸í•˜ëŠ” ì˜ì¡´ì„± í•¨ìˆ˜ë¥¼ ì •ì˜
async def verify_key(x_key: Annotated[str, Header()]):
    """
    Parameters:
        x_key (Annotated[str, Header()]): X-Key í—¤ë”ì˜ ê°’ì„ ë°›ìŠµë‹ˆë‹¤.

    Raises:
        HTTPException: í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° 400 ìƒíƒœ ì½”ë“œì™€ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    """
    if x_key != "fake-super-secret-key":
        raise HTTPException(status_code=400, detail="X-Key header invalid")
    return x_key


# ì˜ì¡´ì„±ì„ verify_tokenê³¼ verify_keyë¡œ ì§€ì •
@app.get("/items/", dependencies=[Depends(verify_token), Depends(verify_key)])
async def read_items():
    return [{"item": "Foo"}, {"item": "Bar"}]
```

#### 5. ì „ì—­ ì˜ì¡´ì„±

```py
from fastapi import Depends, FastAPI, Header, HTTPException
from typing_extensions import Annotated

# í† í°ì„ í™•ì¸í•˜ëŠ” ì˜ì¡´ì„± í•¨ìˆ˜
async def verify_token(x_token: Annotated[str, Header()]):
    """
    Parameters:
        x_token (Annotated[str, Header()]): X-Token í—¤ë”ì˜ ê°’ì„ ë°›ëŠ”ë‹¤.

    Raises:
        HTTPException: í† í°ì´ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° 400 ìƒíƒœ ì½”ë“œì™€ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•œë‹¤.
    """
    if x_token != "fake-super-secret-token":
        raise HTTPException(status_code=400, detail="X-Token header invalid")

# í‚¤ë¥¼ í™•ì¸í•˜ëŠ” ì˜ì¡´ì„± í•¨ìˆ˜ë¥¼ ì •ì˜
async def verify_key(x_key: Annotated[str, Header()]):
    """
    Parameters:
        x_key (Annotated[str, Header()]): X-Key í—¤ë”ì˜ ê°’ì„ ë°›ëŠ”ë‹¤.

    Raises:
        HTTPException: í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° 400 ìƒíƒœ ì½”ë“œì™€ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•œë‹¤.
    """
    if x_key != "fake-super-secret-key":
        raise HTTPException(status_code=400, detail="X-Key header invalid")
    return x_key

# FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•˜ê³ , ì˜ì¡´ì„±ìœ¼ë¡œ verify_tokenê³¼ verify_keyë¥¼ ì§€ì •í•œë‹¤.
app = FastAPI(dependencies=[Depends(verify_token), Depends(verify_key)])


@app.get("/items/")
async def read_items():
    return [{"item": "Portal Gun"}, {"item": "Plumbus"}]


@app.get("/users/")
async def read_users():
    return [{"username": "Rick"}, {"username": "Morty"}]
```

#### 6. Dependencies with yield

`FastAPI`ì—ì„œëŠ” ì™„ë£Œ í›„ ì¶”ê°€ ë‹¨ê³„ë¥¼ ìˆ˜í–‰í•˜ëŠ” ì¢…ì†ì„±ì„ ì§€ì›í•˜ê¸° ìœ„í•´ `yield` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
> ì¼ë°˜ì ìœ¼ë¡œ ì¢…ì†ì„± í•¨ìˆ˜ì—ì„œ `yield`ë¥¼ ì‚¬ìš©í•˜ë©´ ë°˜ë³µ ê°€ëŠ¥í•œ ê°ì²´(`iterator`)ë¥¼ ë°˜í™˜í•œë‹¤. ì´ ë°˜ë³µ ê°€ëŠ¥í•œ ê°ì²´ëŠ” ì—¬ëŸ¬ ë²ˆì˜ ê°’ì„ ë°˜í™˜í•  ìˆ˜ ìˆë‹¤.

1. `yield`ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì¢…ì†ì„±

```py
# ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜ì„ ìƒì„±í•˜ê³  ì™„ë£Œ í›„ ë‹«ëŠ” í•¨ìˆ˜
async def get_db():
    db = DBSession()    # ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜ ê°ì²´ ìƒì„±
    try:
        yield db    # ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜ ê°ì²´ ë°˜í™˜
    finally:
        db.close()  # ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜ ë‹«ê¸°

# ì¢…ì†ì„±ì—ì„œ try ë¸”ë¡ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° yield ì¢…ì†ì„±ì„ ì‚¬ìš©í•  ë•Œ ë°œìƒí•œ ëª¨ë“  ì˜ˆì™¸ë¥¼ ë°›ê²Œ ëœë‹¤.
```

2. `yield` í•˜ìœ„ ì¢…ì†ì„±

í¬ê¸°ì™€ ëª¨ì–‘ì— ê´€ê³„ì—†ì´ í•˜ìœ„ ì¢…ì†ì„±ê³¼ í•˜ìœ„ ì¢…ì†ì„±ì˜ `"tree"`ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìœ¼ë©°, ì´ë“¤ ì¤‘ ì¼ë¶€ ë˜ëŠ” ì „ë¶€ê°€ `yield`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```py
from typing import Annotated

from fastapi import Depends


async def dependency_a():
    """
    dependency_a í•¨ìˆ˜ëŠ” ì˜ì¡´ì„± Aë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜í•œë‹¤.
    Returns:
        DepA: ìƒì„±ëœ ì˜ì¡´ì„± A ê°ì²´
    """
    dep_a = generate_dep_a()
    try:
        yield dep_a
    finally:
        dep_a.close()


async def dependency_b(dep_a: Annotated[DepA, Depends(dependency_a)]):
    """
    dependency_b í•¨ìˆ˜ëŠ” ì˜ì¡´ì„± Bë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜í•œë‹¤.
    Args:
        dep_a (Annotated[DepA, Depends(dependency_a)]): dependency_a í•¨ìˆ˜ì—ì„œ ìƒì„±ëœ ì˜ì¡´ì„± A
    Returns:
        DepB: ìƒì„±ëœ ì˜ì¡´ì„± B ê°ì²´
    """
    dep_b = generate_dep_b()
    try:
        yield dep_b
    finally:
        dep_b.close(dep_a)


async def dependency_c(dep_b: Annotated[DepB, Depends(dependency_b)]):
    """
    dependency_c í•¨ìˆ˜ëŠ” ì˜ì¡´ì„± Cë¥¼ ìƒì„±í•˜ê³  ë°˜í™˜í•œë‹¤.
    Args:
        dep_b (Annotated[DepB, Depends(dependency_b)]): dependency_b í•¨ìˆ˜ì—ì„œ ìƒì„±ëœ ì˜ì¡´ì„± B
    Returns:
        DepC: ìƒì„±ëœ ì˜ì¡´ì„± C ê°ì²´
    """
    dep_c = generate_dep_c()
    try:
        yield dep_c
    finally:
        dep_c.close(dep_b)
```

3. `yield` ë° `except`ì˜ ì¢…ì†ì„±
`FastAPI`ì—ì„œëŠ” ì¢…ì†ì„± í•¨ìˆ˜ ë‚´ì—ì„œ ë°œìƒí•œ ì˜ˆì™¸ë¥¼ ì ì ˆí•˜ê²Œ ì²˜ë¦¬í•˜ê³  ì‚¬ìš©ìì—ê²Œ ì ì ˆí•œ ì‘ë‹µì„ ì œê³µí•˜ì§€ë§Œ, ì¢…ì†ì„± í•¨ìˆ˜ì—ì„œ ì˜ˆì™¸ë¥¼ í¬ì°©í•˜ê³  ë‹¤ì‹œ ë°œìƒì‹œí‚¤ì§€ ì•ŠëŠ” ê²½ìš° ì˜ˆì™¸ë¥¼ ì¸ì‹í•˜ì§€ ëª»í•  ìˆ˜ ìˆë‹¤.

> ì´ëŸ¬í•œ ê²½ìš°ì—ëŠ” `FastAPI`ê°€ ì¼ë°˜ì ì¸ `Python`ì—ì„œ ë°œìƒí•˜ëŠ” ê²ƒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ì§€ ëª»í•  ìˆ˜ ìˆë‹¤.

```py
from typing import Annotated

from fastapi import Depends, FastAPI, HTTPException

app = FastAPI()

# ë‚´ë¶€ ì˜¤ë¥˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ í´ë˜ìŠ¤
class InternalError(Exception):
    pass

def get_username():
    """
    ì‚¬ìš©ì ì´ë¦„ì„ ë°˜í™˜í•˜ëŠ” ì œë„ˆë ˆì´í„° í•¨ìˆ˜

    Yields:
        str: ì‚¬ìš©ì ì´ë¦„("Rick")ì„ ë°˜í™˜
    """
    try:
        yield "Rick"
    except InternalError:   # ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²½ìš°
        print("Oops, we didn't raise again, Britney ğŸ˜±")    # ì˜ˆì™¸ë¥¼ ë‹¤ì‹œ ë°œìƒì‹œí‚¤ì§€ ì•Šê³  ë©”ì‹œì§€ ì¶œë ¥


@app.get("/items/{item_id}")
def get_item(item_id: str, username: Annotated[str, Depends(get_username)]):
    """
    "/items/{item_id}" ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ í•¸ë“¤ëŸ¬

    Parameters:
        item_id (str): ì•„ì´í…œ ID
        username (Annotated[str, Depends(get_username)]): ì‚¬ìš©ì ì´ë¦„
    Raises:
        InternalError: ì•„ì´í…œ IDê°€ "portal-gun"ì¸ ê²½ìš° ë‚´ë¶€ ì˜¤ë¥˜ ë°œìƒ

    Returns:
        str: ìš”ì²­ëœ ì•„ì´í…œ ID ë°˜í™˜
    """
    if item_id == "portal-gun":
        raise InternalError(
            f"The portal gun is too dangerous to be owned by {username}"
        )
    if item_id != "plumbus":
        raise HTTPException(
            status_code=404, detail="Item not found, there's only a plumbus here"
        )
    return item_id

# ë‚´ë¶€ ì˜¤ë¥˜ë¥¼ ì²˜ë¦¬í•œ í›„ì—ëŠ” ë‹¤ì‹œ í•´ë‹¹ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•Šê³  ìˆê¸° ë•Œë¬¸ì—, FastAPIëŠ” ì´ ì˜ˆì™¸ë¥¼ ê°ì§€í•  ìˆ˜ ì—†ë‹¤.
```

4. ì˜ì¡´ì„±ì— `yield`ì™€ `except`ë¥¼ ì‚¬ìš©í•  ë•Œ í•­ìƒ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œì¼œì•¼ í•œë‹¤.
ì˜ì¡´ì„±ì—ì„œ ì˜ˆì™¸ë¥¼ ì¡ì„ ë•ŒëŠ”, ë‹¤ë¥¸ `HTTPException` ë˜ëŠ” ë¹„ìŠ·í•œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•ŠëŠ” í•œ, ì›ë˜ì˜ ì˜ˆì™¸ë¥¼ ë‹¤ì‹œ ë°œìƒì‹œì¼œì•¼ í•œë‹¤.

> ë™ì¼í•œ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¤ë ¤ë©´ `raise`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```py
from typing import Annotated

from fastapi import Depends, FastAPI, HTTPException

app = FastAPI()

# ë‚´ë¶€ ì˜¤ë¥˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ í´ë˜ìŠ¤
class InternalError(Exception):
    pass


def get_username():
    """
    ì‚¬ìš©ì ì´ë¦„ì„ ë°˜í™˜í•˜ëŠ” ì œë„ˆë ˆì´í„° í•¨ìˆ˜

    Yields:
        str: ì‚¬ìš©ì ì´ë¦„("Rick")ì„ ë°˜í™˜
    """
    try:
        yield "Rick"
    except InternalError:
        print("We don't swallow the internal error here, we raise again ğŸ˜")
        raise   # ì›ë˜ ì˜ˆì™¸ë¥¼ ë‹¤ì‹œ ì œê¸°í•œë‹¤.


@app.get("/items/{item_id}")
def get_item(item_id: str, username: Annotated[str, Depends(get_username)]):
    """
    Parameters:
        item_id (str): ì•„ì´í…œ ID
        username (Annotated[str, Depends(get_username)]): ì‚¬ìš©ì ì´ë¦„\

    Raises:
        InternalError: ì•„ì´í…œ IDê°€ "portal-gun"ì¸ ê²½ìš° ë‚´ë¶€ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.

    Returns:
        str: ìš”ì²­ëœ ì•„ì´í…œ ID ë°˜í™˜
    """
    if item_id == "portal-gun":
        raise InternalError(
            f"The portal gun is too dangerous to be owned by {username}"
        )   # ë‚´ë¶€ ì˜¤ë¥˜ ë°œìƒ
    if item_id != "plumbus":
        raise HTTPException(
            status_code=404, detail="Item not found, there's only a plumbus here"
        )   # HTTP 404 ì˜ˆì™¸ ë°œìƒ
    return item_id
```
